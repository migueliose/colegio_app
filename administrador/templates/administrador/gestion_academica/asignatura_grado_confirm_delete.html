{% extends 'gestioncolegio/base.html' %}
{% load static %}

{% block title %}Eliminar Asignatura por Grado - Colegio App{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Tarjeta de confirmación -->
            <div class="card border-0 shadow-lg mt-4">
                <div class="card-header bg-danger text-white">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-25 p-2 rounded me-3">
                            <i class="fas fa-exclamation-triangle fa-2x"></i>
                        </div>
                        <div>
                            <h4 class="mb-0">
                                <i class="fas fa-trash me-2"></i>Confirmar Eliminación
                            </h4>
                            <p class="mb-0 small opacity-75">Asignatura por Grado y Año</p>
                        </div>
                    </div>
                </div>
                
                <div class="card-body p-5">
                    <!-- Icono de advertencia -->
                    <div class="text-center mb-4">
                        <div class="bg-danger-subtle d-inline-flex p-4 rounded-circle mb-3">
                            <i class="fas fa-exclamation-circle fa-4x text-danger"></i>
                        </div>
                        <h3 class="text-danger mb-3">¿Está seguro de eliminar esta asignatura?</h3>
                    </div>
                    
                    <!-- Información del registro -->
                    <div class="alert alert-info">
                        <div class="d-flex">
                            <i class="fas fa-info-circle me-3 mt-1 fa-lg"></i>
                            <div>
                                <h5 class="alert-heading">Información del Registro</h5>
                                <hr>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p class="mb-2">
                                            <strong><i class="fas fa-book me-2"></i>Asignatura:</strong><br>
                                            <span class="ms-4">{{ object.asignatura.nombre }}</span>
                                        </p>
                                        <p class="mb-2">
                                            <strong><i class="fas fa-layer-group me-2"></i>Área:</strong><br>
                                            <span class="ms-4">{{ object.asignatura.area.nombre }}</span>
                                        </p>
                                        <p class="mb-2">
                                            <strong><i class="fas fa-graduation-cap me-2"></i>Nivel:</strong><br>
                                            <span class="ms-4">
                                                <span class="badge bg-{% if object.asignatura.area.nivel_escolar.nombre == 'Preescolar' %}info{% else %}warning{% endif %}">
                                                    {{ object.asignatura.area.nivel_escolar.nombre }}
                                                </span>
                                            </span>
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-2">
                                            <strong><i class="fas fa-calendar-alt me-2"></i>Año Lectivo:</strong><br>
                                            <span class="ms-4">{{ object.grado_año_lectivo.año_lectivo.anho }}</span>
                                        </p>
                                        <p class="mb-2">
                                            <strong><i class="fas fa-building me-2"></i>Sede:</strong><br>
                                            <span class="ms-4">{{ object.sede.nombre }}</span>
                                        </p>
                                        <p class="mb-2">
                                            <strong><i class="fas fa-graduation-cap me-2"></i>Grado:</strong><br>
                                            <span class="ms-4">{{ object.grado_año_lectivo.grado.nombre }}</span>
                                        </p>
                                    </div>
                                </div>
                                {% if object.docente %}
                                <p class="mb-2">
                                    <strong><i class="fas fa-chalkboard-teacher me-2"></i>Docente:</strong><br>
                                    <span class="ms-4">{{ object.docente.usuario.get_full_name }}</span>
                                </p>
                                {% endif %}
                                <p class="mb-0 mt-2">
                                    <strong><i class="fas fa-calendar me-2"></i>Fecha Creación:</strong>
                                    {{ object.created_at|date:"d/m/Y H:i" }}
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Estadísticas de elementos relacionados -->
                    <div class="row text-center mb-4">
                        <div class="col-md-4">
                            <div class="border rounded p-3 bg-light">
                                <h2 class="text-danger">{{ horarios_count|default:0 }}</h2>
                                <p class="mb-0">Horarios asociados</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="border rounded p-3 bg-light">
                                <h2 class="text-danger">{{ notas_count|default:0 }}</h2>
                                <p class="mb-0">Calificaciones</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="border rounded p-3 bg-light">
                                <h2 class="text-danger">{{ logros_count|default:0 }}</h2>
                                <p class="mb-0">Logros definidos</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advertencias importantes -->
                    <div class="alert alert-warning">
                        <div class="d-flex">
                            <i class="fas fa-exclamation-triangle me-3 mt-1 fa-lg"></i>
                            <div>
                                <h5 class="alert-heading">¡Advertencia Importante!</h5>
                                <p>Esta acción <strong>NO SE PUEDE DESHACER</strong> y eliminará:</p>
                                <ul class="mb-2">
                                    <li>Todos los horarios de clase asociados</li>
                                    <li>Las calificaciones registradas para esta asignatura</li>
                                    <li>Los logros académicos definidos</li>
                                    <li>Cualquier registro relacionado</li>
                                </ul>
                                <p class="mb-0">
                                    <strong>Impacto:</strong> Los estudiantes perderán el historial de esta asignatura.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Alternativa sugerida -->
                    <div class="alert alert-success">
                        <div class="d-flex">
                            <i class="fas fa-lightbulb me-3 mt-1 fa-lg"></i>
                            <div>
                                <h5 class="alert-heading">Alternativa Recomendada</h5>
                                <p class="mb-2">
                                    En lugar de eliminar, puede:
                                </p>
                                <div class="d-flex gap-2">
                                    <a href="{% url 'administrador:asignatura_grado_update' object.pk %}" 
                                       class="btn btn-outline-success btn-sm">
                                        <i class="fas fa-edit me-1"></i>Editar y Reasignar
                                    </a>
                                    <a href="{% url 'administrador:asignatura_grado_list' %}" 
                                       class="btn btn-outline-info btn-sm">
                                        <i class="fas fa-list me-1"></i>Ver Todas las Asignaturas
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Formulario de confirmación -->
                    <div class="border-top pt-4 mt-4">
                        <form method="post">
                            {% csrf_token %}
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <!-- Botón Cancelar -->
                                <a href="{% url 'administrador:asignatura_grado_list' %}" 
                                   class="btn btn-outline-secondary btn-lg me-md-2">
                                    <i class="fas fa-arrow-left me-2"></i>Cancelar y Volver
                                </a>
                                
                                <!-- Botón Eliminar -->
                                <button type="submit" 
                                        class="btn btn-danger btn-lg" 
                                        onclick="return confirmDelete()">
                                    <i class="fas fa-trash me-2"></i>Sí, Eliminar Definitivamente
                                </button>
                            </div>
                            
                            <!-- Confirmación adicional -->
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="confirmCheckbox" required>
                                <label class="form-check-label" for="confirmCheckbox">
                                    <strong>Confirmo que he leído las advertencias y deseo proceder con la eliminación permanente.</strong>
                                </label>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="card-footer bg-light">
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted">
                                <i class="fas fa-shield-alt me-1"></i>
                                Acción registrada en auditoría del sistema
                            </small>
                        </div>
                        <div class="col-md-6 text-end">
                            <small class="text-muted">
                                ID: {{ object.pk }} | Usuario: {{ user.get_full_name|default:user.username }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Información adicional -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-body">
                    <h6 class="mb-3">
                        <i class="fas fa-question-circle me-2"></i>¿Necesita ayuda?
                    </h6>
                    <p class="small mb-2">
                        Si tiene dudas sobre esta operación, contacte al administrador del sistema 
                        antes de proceder con la eliminación.
                    </p>
                    <div class="d-flex gap-2">
                        <a href="{% url 'administrador:dashboard' %}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-home me-1"></i>Ir al Dashboard
                        </a>
                        <a href="{% url 'administrador:asignatura_grado_list' %}" class="btn btn-outline-info btn-sm">
                            <i class="fas fa-list me-1"></i>Ver Todas las Asignaturas
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function confirmDelete() {
    // Validar checkbox de confirmación
    var checkbox = document.getElementById('confirmCheckbox');
    if (!checkbox.checked) {
        alert('Debe marcar la casilla de confirmación para proceder.');
        checkbox.focus();
        return false;
    }
    
    // Confirmación final
    if (!confirm('⚠️ ÚLTIMA ADVERTENCIA\n\n¿Está absolutamente seguro de eliminar esta asignatura permanentemente?\n\nEsta acción NO SE PUEDE DESHACER.')) {
        return false;
    }
    
    // Mostrar indicador de carga
    var submitBtn = event.target;
    if (submitBtn && submitBtn.tagName === 'BUTTON') {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Eliminando...';
    }
    
    return true;
}

// Prevenir envío del formulario con Enter
document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.target.type.includes('submit')) {
        e.preventDefault();
    }
});

// Enfocar el checkbox al cargar la página
document.addEventListener('DOMContentLoaded', function() {
    var checkbox = document.getElementById('confirmCheckbox');
    if (checkbox) {
        checkbox.focus();
    }
});
</script>
{% endblock %}