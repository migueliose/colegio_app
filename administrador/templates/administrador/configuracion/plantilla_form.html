<!-- administrador/configuracion/plantilla_form.html -->
{% extends 'gestioncolegio/base2.html' %}
{% load static %}

{% block title %}{{ title }} - Configuración{% endblock %}

{% block extra_css %}
<style>
    .card-header {
        background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
        color: #495057;
    }
    .code-editor {
        font-family: 'Courier New', monospace;
        font-size: 14px;
        line-height: 1.5;
    }
    .variables-help {
        background-color: #f8f9fa;
        border-radius: 5px;
        padding: 15px;
        margin-top: 10px;
        border-left: 4px solid #6c757d;
    }
    .variable-example {
        font-family: 'Courier New', monospace;
        background-color: #e9ecef;
        padding: 2px 6px;
        border-radius: 3px;
        margin: 0 2px;
    }
    .tab-content {
        border: 1px solid #dee2e6;
        border-top: none;
        padding: 20px;
        border-radius: 0 0 5px 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header border-0 py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-file-certificate me-2"></i>{{ title }}
                        </h4>
                        <a href="{% url 'administrador:plantilla_list' %}" class="btn btn-light btn-sm">
                            <i class="fas fa-arrow-left me-1"></i> Volver
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <form method="post" novalidate>
                        {% csrf_token %}
                        
                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        <!-- Nombre de la Plantilla -->
                        <div class="mb-4">
                            <label for="{{ form.nombre.id_for_label }}" class="form-label">
                                Nombre de la Plantilla <span class="text-danger">*</span>
                            </label>
                            {{ form.nombre }}
                            {% if form.nombre.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.nombre.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                            <div class="form-text">
                                Identifique la plantilla con un nombre descriptivo
                            </div>
                        </div>
                        
                        <!-- Pestañas para Variables y HTML -->
                        <ul class="nav nav-tabs mb-3" id="plantillaTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="html-tab" data-bs-toggle="tab" 
                                        data-bs-target="#html-tab-pane" type="button" role="tab">
                                    <i class="fas fa-code me-1"></i> Contenido HTML
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="variables-tab" data-bs-toggle="tab" 
                                        data-bs-target="#variables-tab-pane" type="button" role="tab">
                                    <i class="fas fa-tags me-1"></i> Variables Disponibles
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="plantillaTabsContent">
                            <!-- Contenido HTML -->
                            <div class="tab-pane fade show active" id="html-tab-pane" role="tabpanel">
                                <div class="mb-3">
                                    <label for="{{ form.contenido_html.id_for_label }}" class="form-label">
                                        Código HTML de la Plantilla <span class="text-danger">*</span>
                                    </label>
                                    {{ form.contenido_html }}
                                    {% if form.contenido_html.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.contenido_html.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    <div class="form-text">
                                        Use variables entre dobles llaves: <code>{{ "{{ variable }}" }}</code>
                                    </div>
                                </div>
                                
                                <div class="variables-help">
                                    <h6 class="mb-2"><i class="fas fa-lightbulb me-1"></i>Variables Predefinidas:</h6>
                                    <p class="mb-2 small">Puede usar estas variables en su plantilla:</p>
                                    <div class="mb-2">
                                        <span class="variable-example">{{ "{{ nombre_estudiante }}" }}</span>
                                        <span class="variable-example">{{ "{{ documento_estudiante }}" }}</span>
                                        <span class="variable-example">{{ "{{ grado }}" }}</span>
                                        <span class="variable-example">{{ "{{ año_lectivo }}" }}</span>
                                        <span class="variable-example">{{ "{{ fecha_actual }}" }}</span>
                                        <span class="variable-example">{{ "{{ nombre_colegio }}" }}</span>
                                        <span class="variable-example">{{ "{{ direccion_colegio }}" }}</span>
                                        <span class="variable-example">{{ "{{ codigo_certificado }}" }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Variables Disponibles -->
                            <div class="tab-pane fade" id="variables-tab-pane" role="tabpanel">
                                <div class="mb-3">
                                    <label for="{{ form.variables_disponibles.id_for_label }}" class="form-label">
                                        Variables Disponibles (separadas por coma)
                                    </label>
                                    {{ form.variables_disponibles }}
                                    {% if form.variables_disponibles.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.variables_disponibles.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    <div class="form-text">
                                        Liste las variables que pueden usarse en esta plantilla. Ej: nombre_estudiante, grado, año_lectivo
                                    </div>
                                </div>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Importante:</strong> Las variables deben coincidir exactamente con las usadas en el HTML.
                                    Use nombres descriptivos en minúsculas y separados por guiones bajos.
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <a href="{% url 'administrador:plantilla_list' %}" class="btn btn-outline-secondary me-md-2">
                                <i class="fas fa-times me-1"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> {{ submit_text }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block inline_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Añadir clases Bootstrap
        const textInputs = document.querySelectorAll('input[type="text"]');
        const textareas = document.querySelectorAll('textarea');
        
        textInputs.forEach(input => input.classList.add('form-control'));
        textareas.forEach(textarea => {
            textarea.classList.add('form-control');
            textarea.classList.add('code-editor');
            textarea.rows = 15;
        });
        
        // Inicializar pestañas de Bootstrap
        const triggerTabList = [].slice.call(document.querySelectorAll('#plantillaTabs button'));
        triggerTabList.forEach(function (triggerEl) {
            const tabTrigger = new bootstrap.Tab(triggerEl);
            triggerEl.addEventListener('click', function (event) {
                event.preventDefault();
                tabTrigger.show();
            });
        });
    });
</script>
{% endblock %}