<!-- administrador/configuracion/plantilla_detail.html -->
{% extends 'gestioncolegio/base.html' %}
{% load static %}

{% block title %}{{ plantilla.nombre }} - Detalle{% endblock %}

{% block extra_css %}
<style>
    .card-header {
        background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
        color: #495057;
    }
    .template-preview {
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 20px;
        background-color: white;
        min-height: 400px;
        overflow: auto;
    }
    .variable-badge {
        background-color: #e3f2fd;
        color: #1976d2;
        font-family: 'Courier New', monospace;
        padding: 3px 8px;
        border-radius: 3px;
        margin: 2px;
        font-size: 0.9rem;
    }
    .info-card {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'administrador:dashboard' %}">Inicio</a></li>
                            <li class="breadcrumb-item"><a href="{% url 'administrador:plantilla_list' %}">Plantillas</a></li>
                            <li class="breadcrumb-item active">{{ plantilla.nombre }}</li>
                        </ol>
                    </nav>
                    <h2 class="mb-0"><i class="fas fa-file-certificate me-2"></i>{{ plantilla.nombre }}</h2>
                </div>
                <div>
                    <a href="{% url 'administrador:plantilla_update' plantilla.pk %}" class="btn btn-primary">
                        <i class="fas fa-edit me-1"></i> Editar
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Información de la Plantilla -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title mb-4">
                        <i class="fas fa-info-circle me-2"></i>Información
                    </h5>
                    
                    <div class="info-card">
                        <label class="small text-muted mb-1">Fecha de Creación:</label>
                        <p class="mb-0 fw-semibold">{{ plantilla.created_at|date:"d/m/Y H:i" }}</p>
                    </div>
                    
                    <div class="info-card">
                        <label class="small text-muted mb-1">Última Actualización:</label>
                        <p class="mb-0 fw-semibold">{{ plantilla.updated_at|date:"d/m/Y H:i" }}</p>
                    </div>
                    
                    {% if plantilla.variables_disponibles %}
                    <div class="info-card">
                        <label class="small text-muted mb-2 d-block">Variables Disponibles:</label>
                        <div>
                            {% for variable in plantilla.variables_disponibles|split:"," %}
                                {% if variable.strip %}
                                <span class="variable-badge d-inline-block mb-1">{{ variable.strip }}</span>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-md-8">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-eye me-2"></i>Vista Previa
                        </h5>
                        <button class="btn btn-sm btn-outline-secondary" onclick="togglePreview()">
                            <i class="fas fa-code me-1"></i> Ver Código
                        </button>
                    </div>
                    
                    <!-- Vista Previa HTML -->
                    <div id="html-preview" class="template-preview">
                        {{ plantilla.contenido_html|safe }}
                    </div>
                    
                    <!-- Código HTML -->
                    <div id="html-code" class="template-preview" style="display: none;">
                        <pre><code class="language-html">{{ plantilla.contenido_html }}</code></pre>
                    </div>
                    
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-exclamation-triangle me-1"></i>
                            Nota: Esta es una vista previa estática. Las variables se muestran como texto plano.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Acciones -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">Acciones Disponibles</h6>
                            <p class="text-muted mb-0 small">Gestione esta plantilla de certificados</p>
                        </div>
                        <div class="btn-group">
                            <a href="{% url 'administrador:plantilla_update' plantilla.pk %}" 
                               class="btn btn-outline-primary">
                                <i class="fas fa-edit me-1"></i> Editar Plantilla
                            </a>
                            <a href="{% url 'administrador:plantilla_list' %}" 
                               class="btn btn-outline-secondary">
                                <i class="fas fa-list me-1"></i> Ver Todas
                            </a>
                            <a href="#" class="btn btn-outline-danger">
                                <i class="fas fa-trash me-1"></i> Eliminar
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block inline_js %}
<script>
    function togglePreview() {
        const preview = document.getElementById('html-preview');
        const code = document.getElementById('html-code');
        const button = event.target.closest('button');
        
        if (preview.style.display === 'none') {
            preview.style.display = 'block';
            code.style.display = 'none';
            button.innerHTML = '<i class="fas fa-code me-1"></i> Ver Código';
        } else {
            preview.style.display = 'none';
            code.style.display = 'block';
            button.innerHTML = '<i class="fas fa-eye me-1"></i> Ver Previa';
        }
    }
    
    // Resaltar sintaxis en el código (simple)
    document.addEventListener('DOMContentLoaded', function() {
        const codeElement = document.getElementById('html-code');
        if (codeElement) {
            const code = codeElement.querySelector('code');
            let html = code.textContent;
            
            // Simple highlighting para variables
            html = html.replace(/\{\{([^}]+)\}\}/g, '<span class="text-primary fw-bold">{{ $1 }}</span>');
            html = html.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            
            code.innerHTML = html;
        }
    });
</script>
{% endblock %}