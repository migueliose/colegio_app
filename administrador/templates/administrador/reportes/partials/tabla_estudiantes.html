<!-- templates/administrador/reportes/partials/tabla_estudiantes.html -->
<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>#</th>
                <th>Estudiante</th>
                <th>Documento</th>
                <th>Edad</th>
                <th>Género</th>
                <th>Sede</th>
                <th>Grado</th>
                <th>Estado</th>
                <th>Año Lectivo</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for dato in estudiantes_con_datos %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>
                    <div class="d-flex align-items-center">
                        {% if dato.estudiante.foto %}
                            <img src="{{ dato.estudiante.foto.url }}" class="student-avatar me-2" alt="{{ dato.estudiante.usuario.get_full_name }}">
                        {% else %}
                            <div class="student-avatar bg-secondary d-flex align-items-center justify-content-center me-2">
                                <i class="bi bi-person text-white"></i>
                            </div>
                        {% endif %}
                        <div>
                            <strong>{{ dato.estudiante.usuario.get_full_name }}</strong>
                            <div class="text-muted small">{{ dato.estudiante.usuario.email|default:"Sin email" }}</div>
                        </div>
                    </div>
                </td>
                <td>{{ dato.estudiante.usuario.numero_documento }}</td>
                <td>
                    {% if dato.edad %}
                        <span class="age-badge badge">{{ dato.edad }} años</span>
                    {% else %}
                        <span class="text-muted">N/A</span>
                    {% endif %}
                </td>
                <td>
                    {% if dato.estudiante.usuario.sexo == 'M' %}
                        <span class="badge bg-primary">Masculino</span>
                    {% elif dato.estudiante.usuario.sexo == 'F' %}
                        <span class="badge bg-pink">Femenino</span>
                    {% else %}
                        <span class="badge bg-secondary">No especificado</span>
                    {% endif %}
                </td>
                <td>
                    {% if dato.matricula %}
                        {{ dato.matricula.sede.nombre }}
                    {% else %}
                        <span class="text-muted">
                            {% if dato.año_filtrado %}
                                Sin matrícula en {{ dato.año_filtrado }}
                            {% else %}
                                Sin matrícula
                            {% endif %}
                        </span>
                    {% endif %}
                </td>
                <td>
                    {% if dato.matricula %}
                        {{ dato.matricula.grado_año_lectivo.grado.nombre }}
                    {% else %}
                        <span class="text-muted">N/A</span>
                    {% endif %}
                </td>
                <td>
                    {% if dato.matricula %}
                        {% if dato.matricula.estado == 'ACT' %}
                            <span class="badge bg-success status-badge">Activo</span>
                        {% elif dato.matricula.estado == 'PEN' %}
                            <span class="badge bg-warning status-badge">Pendiente</span>
                        {% elif dato.matricula.estado == 'INA' %}
                            <span class="badge bg-secondary status-badge">Inactivo</span>
                        {% elif dato.matricula.estado == 'RET' %}
                            <span class="badge bg-danger status-badge">Retirado</span>
                        {% endif %}
                    {% else %}
                        <span class="badge bg-dark status-badge">
                            {% if dato.año_filtrado %}
                                Sin matrícula
                            {% else %}
                                No matriculado
                            {% endif %}
                        </span>
                    {% endif %}
                </td>
                <td>
                    {% if dato.matricula %}
                        {{ dato.matricula.año_lectivo.anho }}
                    {% elif dato.año_filtrado %}
                        <span class="text-muted">{{ dato.año_filtrado }} (sin matrícula)</span>
                    {% else %}
                        <span class="text-muted">N/A</span>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <a href="#" class="btn btn-outline-primary" title="Ver perfil">
                            <i class="bi bi-eye"></i>
                        </a>
                        <a href="{% url 'administrador:reporte_notas' %}?tipo=individual&estudiante={{ dato.estudiante.id }}" class="btn btn-outline-success" title="Ver notas">
                            <i class="bi bi-journal-text"></i>
                        </a>
                        <a href="{% url 'administrador:reporte_asistencia' %}?estudiante={{ dato.estudiante.id }}" class="btn btn-outline-info" title="Ver asistencia">
                            <i class="bi bi-calendar-check"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="10" class="text-center py-4">
                    <i class="bi bi-people display-4 text-muted"></i>
                    <h5 class="mt-3">No se encontraron estudiantes</h5>
                    <p class="text-muted">Intenta con otros filtros de búsqueda</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
.student-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}

.status-badge {
    font-size: 0.75rem;
}

.age-badge {
    background-color: #e9ecef;
    color: #495057;
    font-size: 0.8rem;
}

.bg-pink {
    background-color: #d63384 !important;
}
</style>